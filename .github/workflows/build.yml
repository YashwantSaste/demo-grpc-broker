name: Java SDK Build

on:
  push:
    paths:
      - 'src/main/proto/**'
      - 'pom.xml'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: 🛠️ Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: 🧹 Delete previously generated sources
        run: |
          echo "Deleting old src/generated folder..."
          rm -rf src/generated || echo "No existing generated folder found."
          echo "Deleted (if existed)."

      - name: ⚙️ Run Maven to generate sources
        run: |
          echo "Running 'mvn clean compile' to regenerate proto classes..."
          mvn clean compile
          echo "Compilation done."

      - name: 📂 Show folder structure of generated sources
        run: |
          echo "Listing generated files in src/generated:"
          find src/generated || echo "No files found in src/generated."

      - name: 📖 Print contents of generated .java files (first 20 lines each)
        run: |
          echo "Reading generated .java files (showing first 20 lines per file):"
          for file in $(find src/generated -name "*.java"); do
            echo "----- $file -----"
            head -n 20 "$file"
            echo
          done
